<!doctype html><html><head>
<meta charset='utf-8'/><meta name='viewport' content='width=device-width, initial-scale=1'/>
<title>User • Home</title><link rel='stylesheet' href='/css/theme.css'/></head><body>
<aside class='sidebar'><div style='font-weight:700;margin-bottom:12px'>OpenInterview.me</div><a class='navlink muted' href='/profile.html'>Home</a><a class='navlink' href='/availability.html'>Availability</a><a class='navlink' href='/profiles.html'>Profiles</a><a class='navlink' href='/uploads.html'>Uploads</a><a class='navlink' href='/subscription.html'>Subscription</a><a class='navlink' href='/password.html'>Password</a><a class='navlink' href='/login.html'>Log Out</a><button class='btn' style='margin-top:8px;width:100%;background:#f7f7f7;color:#111'>Upgrade</button></aside>
<main class='main'><div class='container'>
<h1>Home</h1>
<div class='section'><h2>Metrics</h2>
  <div style='display:flex;gap:16px;flex-wrap:wrap'>
    <div class='card' style='padding:12px;min-width:160px'><div class='muted'>Interviews</div><div id='m-interviews' style='font-size:22px;font-weight:700'>—</div></div>
    <div class='card' style='padding:12px;min-width:160px'><div class='muted'>Profile Views</div><div id='m-views' style='font-size:22px;font-weight:700'>—</div></div>
    <div class='card' style='padding:12px;min-width:160px'><div class='muted'>Shares</div><div id='m-shares' style='font-size:22px;font-weight:700'>—</div></div>
    <div style='flex:1'></div>
    <button id='quick-share' class='btn'>Share Profile</button>
    <a class='btn out' href='/profiles.html'>Manage Profiles</a>
  </div>
</div>
<div class='section'><h2>Upcoming Interviews</h2>
  <table><thead><tr><th>When</th><th>Title</th><th>Company</th><th>Recruiter</th><th></th></tr></thead>
  <tbody id='upcomingRows'><tr><td class='muted' colspan='5'>Loading…</td></tr></tbody></table>
</div>
<div class='section'><h2>My Interviews</h2>
  <table><thead><tr><th>When</th><th>Title</th><th>Company</th><th>Recruiter</th><th></th></tr></thead>
  <tbody id='myRows'><tr><td class='muted' colspan='5'>Loading…</td></tr></tbody></table>
</div>
</div></main>
<script type='module'>
import {api, requireUser, $} from '/js/app.js';
const u = requireUser();
(async function init(){
  const m = await api(`/api/metrics?userId=${u.id}`);
  $('#m-interviews').textContent = m.totalInterviews;
  $('#m-views').textContent = m.totalViews;
  $('#m-shares').textContent = m.totalShares;

  const up = await api(`/api/interviews?scope=upcoming&userId=${u.id}`);
  const mine = await api(`/api/interviews?scope=mine&userId=${u.id}`);
  const fmt = (s)=> new Date(s).toLocaleString();
  const row = (i)=> `<tr><td>${fmt(i.when)}</td><td>${i.title}</td><td>${i.company}</td><td>${i.recruiter}</td><td><button class='btn out' data-del='${i.id}'>Delete</button></td></tr>`;
  document.querySelector('#upcomingRows').innerHTML = up.length? up.map(row).join('') : '<tr><td class="muted" colspan="5">No upcoming interviews</td></tr>';
  document.querySelector('#myRows').innerHTML = mine.length? mine.map(row).join('') : '<tr><td class="muted" colspan="5">No interviews</td></tr>';
  document.querySelector('#myRows').addEventListener('click', async (e)=>{ const id=e.target?.dataset?.del; if(id){ await api('/api/interviews/'+id, {method:'DELETE'}); location.reload(); } });
  document.querySelector('#quick-share').onclick = async ()=>{ 
    const list = await api(`/api/profiles?userId=${u.id}`);
    if(!list.length) return alert('No profiles yet');
    const target = list.find(p=>p.isDefault) || list[0];
    const url = `${location.origin}/u/${target.handle}`;
    await navigator.clipboard.writeText(url); alert('Default profile link copied');
  };
})();
</script>
</body></html>