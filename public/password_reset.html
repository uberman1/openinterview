<!DOCTYPE html><html lang="en"><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Password Reset</title>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' https: 'unsafe-inline'; style-src 'self' https: 'unsafe-inline'; img-src 'self' data: https:">
</head>
<body>
  <main id="content">
    <a id="back_to_login" href="/login.html">Back to login</a>
    <div id="errors" role="alert" aria-live="assertive" style="display:none;"></div>

    <form id="password-form" method="post" action="/api/reset">
    <label for="email">Email</label>
    <input id="email" name="email" type="email" autocomplete="email" required="">

    <label for="token">Reset Token</label>
    <input id="token" name="token" type="text" required="">

    <label for="new_password">New Password</label>
    <input id="new_password" name="new_password" type="password" aria-describedby="pw_rules pw_strength" required="">

    <button id="toggle_pw" type="button" aria-controls="new_password">Show/Hide</button>

    <label for="confirm_password">Confirm New Password</label>
    <input id="confirm_password" name="confirm_password" type="password" required="">

    <p id="pw_rules">Must be 8+ chars, include upper/lower/number/symbol.</p>
    <div id="pw_strength" aria-live="polite">Strength: </div>

    <input type="hidden" id="csrf_token" name="csrf_token" value="test-token">
    <button id="submit_btn" type="submit" disabled="">Reset Password</button>
  </form>

  <script>
    const np = document.getElementById('new_password');
    const cp = document.getElementById('confirm_password');
    const sb = document.getElementById('submit_btn');
    const ps = document.getElementById('pw_strength');
    const tg = document.getElementById('toggle_pw');

    function strength(v){ let s=0; if(v.length>=8)s++; if(/[A-Z]/.test(v))s++; if(/[a-z]/.test(v))s++; if(/[0-9]/.test(v))s++; if(/[^A-Za-z0-9]/.test(v))s++; return ["","very weak","weak","ok","good","strong"][s]; }
    function validate(){
      const ok = np.value && cp.value && np.value===cp.value;
      sb.toggleAttribute('disabled', !ok);
      ps.textContent = "Strength: " + (np.value ? strength(np.value) : "");
    }
    np.addEventListener('input', validate);
    cp.addEventListener('input', validate);
    tg.addEventListener('click', ()=>{ np.type = (np.type==='password'?'text':'password'); });
    
    document.getElementById('password-form').addEventListener('submit', (e) => {
      e.preventDefault();
      window.location.href = '/password/success.html';
    });
  </script>
  </main>
<script type="module" src="/js/nav-patch.js"></script>
<script type="module" src="/js/redirect-shim.js"></script>
</body></html>