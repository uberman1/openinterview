# Module-1 Engine Wrapper (No-Dependency Server) — Replit-Ready

This package replaces ONLY the server/runtime for Module-1 **without touching your UI files**.
It **does not modify `.replit`** or `package.json`. It **requires no external Node dependencies**.

- Serves your existing `public/` directory (unchanged).
- Provides `/api/auth/login` for the static login cutover.
- Includes **self-test** that uses native `fetch` (Node 18+) — **no supertest**.
- Includes **guardrails** that *seal* your UI checksums on first run, then verify on every test.
- Works with your current manual start: `node index.js`.

## Quick Start (Replit)
1. Upload this folder (or the zip) to your Replit project root.
2. Ensure you already have your UI at `./public/` (login.html, theme.css, index.html, etc.).
3. Start the server (manual):
   ```bash
   node index.js
   ```
4. In a **new shell tab**, run the self-test:
   ```bash
   node selftest.mjs
   ```
   Expected: `Summary: 10 passed, 0 failed`

> If `public/` is missing, the server runs but tests will warn that protected files are not found.

## Endpoints
- GET `/` → redirects to `/login.html`
- Static files from `/public`
- POST `/api/auth/login` → JSON body `{ email, password }`
  - `user@example.com` → `{ role: "user" }`
  - `admin@example.com` → `{ role: "admin" }`
  - Others → `{ role: "guest" }`

## Guardrails
- First test run **seals** hashes of protected files (default set: `public/login.html`, `public/css/theme.css`, `public/index.html`) into `guardrails.json` if it does not exist.
- Subsequent runs verify those checksums to guarantee UI integrity.
- To re-seal after intentional UI updates, delete `guardrails.json` and run the self-test again to snapshot the new hashes.

## Ports
- The server binds to `process.env.PORT || 5000`. Replit usually sets PORT; otherwise 5000 is used.

## Zero External Dependencies
- Pure Node `http`, `fs`, `path`, `url`, `crypto` — no `express`, no `supertest`.
- No edits to `.replit` or `package.json` required.

## Troubleshooting
- **Port already in use**: stop all running processes or pick another shell to run tests.
- **Node version**: Requires Node 18+ for native `fetch`. Replit default images provide this.
- **Public files missing**: Provide your UI under `./public`. Guardrails will warn until files exist.

---

© 2025 — Module-1 Engine Wrapper
