
# Test Mode Switcher (CDN‑Free Tests) – Patch

**What it does**
- In tests, skip external CDNs (Tailwind/Google Fonts) and use local `/css/app.min.css`.
- In prod/dev, nothing changes.

## Files in this patch
- `public/js/style-switcher.js` — activates in test mode and injects local CSS.
- `public/css/app.min.css` — minimal CSS so pages remain usable without Tailwind.

## Wire it (once per page)
Add to `<head>` **after** your existing CDN lines:

```html
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap">

<script defer src="/js/style-switcher.js"></script>
```

Pages to update (recommended): `public/profile_edit_enhanced.html`, `public/index.html`, `public/home.html`, `public/availability.html`.

## Activate test mode
- URL param: `?test=1`
- Playwright flag:
  ```ts
  await page.addInitScript(() => { (window as any).__TEST__ = true; });
  ```
- Session (manual): `sessionStorage.setItem('__TEST__','1'); location.reload();`

## Optional: Replace app.min.css with self‑hosted Tailwind
Build once and drop it in place:
```bash
npm i -D tailwindcss postcss autoprefixer @tailwindcss/forms
npx tailwindcss init
echo "@tailwind base;@tailwind components;@tailwind utilities;" > src/tailwind.css
npx tailwindcss -i ./src/tailwind.css -o ./public/css/app.min.css --minify
```

## Playwright smoke test example
```ts
import { test, expect } from '@playwright/test';

test.beforeEach(async ({ page }) => {
  await page.addInitScript(() => { (window as any).__TEST__ = true; });
});

test('editor visible without CDN', async ({ page }) => {
  await page.goto('http://localhost:5000/profile_edit_enhanced.html');
  await expect(page.locator('#profileNameInput')).toBeVisible();
  await expect(page.getByRole('button', { name: /save|publish/i })).toBeVisible();
});
```

**Why this works:** headless sandboxes often block CDNs. The switcher removes those dependencies during tests so your UI doesn’t disappear.
