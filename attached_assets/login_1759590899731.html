<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sign in â€¢ OpenInterview.me</title>
  <link rel="stylesheet" href="/css/theme.css" />
  <style>
    .brand{border-bottom:1px solid var(--border);padding:12px 24px;font-weight:700}
    .wrap{min-height:calc(100vh - 50px);display:grid;place-items:center;padding:24px}
    .card{width:min(420px,92vw);background:#fff;border:1px solid var(--border);border-radius:var(--r);padding:22px;box-shadow:0 8px 28px rgba(0,0,0,.06)}
    h1{margin:0 0 6px} .sub{color:var(--muted);margin:0 0 14px}
    .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .chip{padding:6px 10px;border:1px solid var(--border);border-radius:999px;cursor:pointer;font-size:13px;background:#fff}
    .err{display:none;color:#b91c1c;background:#fee2e2;border:1px solid #fecaca;border-radius:10px;padding:8px 10px;margin-top:10px}
    .fine{font-size:12px;color:var(--muted);margin-top:10px}
    label{display:block;font-size:12px;color:var(--muted);margin:8px 0 6px}
    .btn{width:100%}
  </style>
</head>
<body>
  <div class="brand">OpenInterview.me</div>
  <main class="wrap">
    <section class="card" aria-labelledby="title">
      <h1 id="title">Sign in</h1>
      <p class="sub">Enter your email to continue.</p>
      <form id="form" novalidate>
        <label for="email">Email</label>
        <input id="email" class="input" type="email" placeholder="you@example.com" autocomplete="email" required />
        <button class="btn" type="submit" style="margin-top:12px">Continue</button>
        <div id="err" class="err" role="alert">Please enter a valid email.</div>
      </form>
      <div class="fine">Demo accounts:</div>
      <div class="row" aria-label="Demo accounts">
        <button class="chip" data-fill="user@example.com">user@example.com</button>
        <button class="chip" data-fill="admin@example.com">admin@example.com</button>
      </div>
  </section>
  </main>
  <script type="module">
    import { api } from "/js/app.js";
    const $ = s => document.querySelector(s);
    document.querySelectorAll('[data-fill]').forEach(b => b.addEventListener('click', ()=>{ $('#email').value = b.dataset.fill; $('#email').focus(); }));
    $('#form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const email = $('#email').value.trim();
      if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){ $('#err').style.display='block'; return; }
      $('#err').style.display='none';
      try{
        const data = await api('/api/auth/login', { method:'POST', body: JSON.stringify({email}) });
        localStorage.setItem('me', JSON.stringify(data.user));
        location.href = data.user.role === 'admin' ? '/admin.html' : '/profile.html';
      }catch(err){ $('#err').textContent='Sign-in failed. Please try again.'; $('#err').style.display='block'; }
    });
  </script>
  <script>
    // Cleanup any old service workers/caches from previous SPA deployments.
    (function cleanup(){
      if ('serviceWorker' in navigator) { navigator.serviceWorker.getRegistrations().then(rs => rs.forEach(r => r.unregister())); }
      if (window.caches && caches.keys) { caches.keys().then(keys => keys.forEach(k => caches.delete(k))); }
    })();
  </script>
<script type="module" src="/js/nav-patch.js"></script>
<script type="module" src="/js/redirect-shim.js"></script>
</body></html>