<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Outbox • OpenInterview</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet"/>
  <style>
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:#0b0b0b;color:#e5e7eb;margin:0}
    header{padding:16px 24px;border-bottom:1px solid #1f2937}
    main{padding:16px 24px}
    .row{padding:12px 8px;border-bottom:1px solid #1f2937;display:flex;gap:12px;align-items:center}
    .row a{color:#93c5fd;text-decoration:none}
    .muted{color:#9ca3af}
    .btn{background:#111827;color:#fff;padding:8px 12px;border-radius:8px;text-decoration:none;border:1px solid #374151}
  </style>
</head>
<body>
  <header>
    <strong>Outbox (dev preview)</strong>
  </header>
  <main>
    <div id="rows"></div>
    <p class="muted" id="empty">No messages yet.</p>
  </main>
<script>
  const key = 'oi.outbox';
  const rows = document.getElementById('rows');
  const empty = document.getElementById('empty');
  const list = JSON.parse(localStorage.getItem(key) || '[]');
  if (list.length) empty.style.display = 'none';
  list.forEach(item => {
    const div = document.createElement('div');
    div.className = 'row';
    div.innerHTML = `
      <div><strong>${item.subject}</strong><div class="muted">${item.to} • ${new Date(item.sentAt).toLocaleString()}</div></div>
      <div style="margin-left:auto">
        <a class="btn" href="javascript:void(0)" data-id="${item.id}">Open</a>
      </div>`;
    rows.appendChild(div);
  });
  rows.addEventListener('click', (e) => {
    const a = e.target.closest('a.btn');
    if (!a) return;
    const id = a.getAttribute('data-id');
    const msg = (JSON.parse(localStorage.getItem(key) || '[]')).find(m=>m.id===id);
    if (!msg) return;
    const blob = new Blob([msg.html], {type:'text/html'});
    const url = URL.createObjectURL(blob);
    const w = 860, h = 900;
    const left = (screen.width - w) / 2;
    const top  = (screen.height - h) / 2;
    window.open(url, 'emailPreview', `width=${w},height=${h},left=${left},top=${top}`);
    setTimeout(()=>URL.revokeObjectURL(url), 10000);
  });
</script>
</body>
</html>
