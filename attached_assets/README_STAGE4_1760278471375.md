# Stage 4 – Production Go-Live Readiness v0.4.0

This package turns your test harness into a **go-live gate** that runs
against a real environment URL and saves pass/fail artifacts under
`qa/stage4/v0.4.0/`.

## What it checks
- **Health contract**: `/health` must return JSON with any of:
  `{"status":"ok"}`, `{"healthy":true}`, or `{"ok":true}` (HTTP 200).
- **Canary pings**: 5 consecutive 200s, report **p95 latency**;
  default budget: p95 < **1000 ms**.
- **Root headers**: fetch **BASE_URL** and assert **CSP present**.
- **Provider guard** (config only): Stripe, Email provider flags present when `EXPECT_LIVE=1`.

## Quick start (Replit/local)

```bash
# Backend should already be running on your target env
export PROD_URL="http://127.0.0.1:8000"
export HEALTH_URL="$PROD_URL/health"

# Optional: require live providers (otherwise stays advisory)
export EXPECT_LIVE=0
export ALLOW_PROVIDER_MOCK=1

PYTHONPATH=. python stage4/run_stage4.py
```

Artifacts:
- `qa/stage4/v0.4.0/summary.json` – machine-readable
- `qa/stage4/v0.4.0/tests.txt` – human-readable

## CI usage
See `ci/stage4_pipeline.yml`. It lets you run the gate against any URL via workflow dispatch.

## Index update
`scripts/update_test2_index_stage4.py` appends a row to `public/test2.html`
under **"Stage 4 — Production Go-Live"**.
