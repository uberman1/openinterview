# OpenInterview • Email Workflow Bundle (v1)

This package wires the complete **share → email → view** loop for OpenInterview without needing a backend:

- `share.html`: standalone "modal-like" page for sending invites
- `js/email_template.js`: builds subject + HTML from sender/message/link
- `js/mailer.mock.js`: stores email to `localStorage` (`oi.outbox`) and opens a preview window
- `email.html`: reference design of the email template (not required at runtime)
- `email_preview.html`: quick preview that renders using URL params
- `outbox.html`: dev-only viewer for the saved emails
- Playwright test (`tests/`) to validate the happy path
- `package.json` with `http-server` for local serve + test

## Run locally (or in Replit)

```bash
npm install
npm run serve
# open http://localhost:4173/share.html?profileId=42
```

Run tests:

```bash
npx playwright install --with-deps
npm run test:e2e
```

## Integrating with Home

On your `home.html` Share links/buttons, open a centered popup:

```html
<a href="#" data-action="share" data-profile-id="123">Share</a>
<script>
document.addEventListener('click', (e) => {
  const el = e.target.closest('[data-action="share"]');
  if (!el) return;
  e.preventDefault();
  const profileId = el.dataset.profileId || '';
  const w=480,h=620,left=(screen.width-w)/2,top=(screen.height-h)/2;
  const win = window.open(`share.html?profileId=${profileId}`, 'shareWindow',
    `width=${w},height=${h},top=${top},left=${left},resizable=no,scrollbars=no`);
  if (!win) location.href = `share.html?profileId=${profileId}`;
});
</script>
```

## Access List (for `access.html`)

Recipients are stored in `localStorage` under the key:

```
oi.access.<profileId or slug>
```

Each entry shape:

```json
{
  "email": "reviewer@example.com",
  "message": "Hi! Check this out.",
  "addedAt": "2025-10-22T12:34:56.000Z",
  "source": "share"
}
```

## Production Hook

Replace the implementation of `sendEmail()` in `js/mailer.mock.js` with an API call to your backend (SendGrid/Mailgun/SES). Keep the same function signature for easy swap:

```js
export async function sendEmail({ to, subject, html }) {
  const res = await fetch('/api/email/send', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ to, subject, html })
  });
  if (!res.ok) throw new Error('Email send failed');
  return await res.json();
}
```
