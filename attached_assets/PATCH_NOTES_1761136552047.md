# OpenInterview — Self-Hosted Tailwind Patch (CDN Removal)

This patch eliminates external CDNs (Tailwind Play + Google Fonts) and builds a **local Tailwind CSS** file
so the app renders consistently in **production, dev, and tests** (including restricted sandboxes).

---

## What’s inside
- `package.json` — scripts for building Tailwind
- `tailwind.config.js` — scans `./public/**/*.html` and `./public/js/**/*.js`
- `postcss.config.js` — PostCSS pipeline
- `src/input.css` — Tailwind entry file
- `public/css/` — build output directory

> Output target: `public/css/tailwind.css`

---

## Install & Build (one-time)
```bash
# from your project root
npm install

# build local Tailwind CSS
npm run build:css

# optional: during development
npm run watch:css
```

This creates: `public/css/tailwind.css`

---

## Replace CDNs in your HTML (critical)
In **each** page that used Tailwind CDN (e.g., `public/profile_edit_enhanced.html`, `public/index.html`, `public/home.html`, `public/availability.html`):

**Remove:**
```html
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap">
<script defer src="/js/style-switcher.js"></script> <!-- if present -->
```

**Add:**
```html
<link rel="stylesheet" href="/css/tailwind.css">
```

> Keep your system font stack in CSS; add Google Fonts later as progressive enhancement if desired.

---

## Optional: Resource-failure diagnostics (temporary)
Add this at the **very top of `<head>`**, then remove after confirmation:

```html
<script>
window.addEventListener('error', (e) => {
  if (e.target && (e.target.tagName === 'SCRIPT' || e.target.tagName === 'LINK')) {
    console.error('[RESOURCE FAILED]', e.target.tagName, e.target.src || e.target.href);
  }
}, true);
</script>
```

This will surface any 404/blocked assets in the console.

---

## Guard: availability UI injector safety
If your `injectRulesUI()` manipulates DOM, add a guard to avoid removing the wrong nodes:

```js
function injectRulesUI(){
  const availSection = document.querySelector('#availabilitySection, [data-section="availability"]');
  if (!availSection) {
    console.warn('[RULES UI] Availability section not found; skipping injection');
    return;
  }
  // ...rest of function...
}
```

---

## Playwright / Tests
With self-hosted Tailwind, **no special test flags are needed**. Your pages link `/css/tailwind.css` directly, so CDNs are never hit.

Optional hardening in tests:
```ts
// Block external fonts just to be safe
await page.route(/fonts\.googleapis\.com|fonts\.gstatic\.com/, r => r.fulfill({ status: 204, body: '' }));
```

---

## Why this fixes your issue
- Removes the CDN race conditions and network restrictions that caused the "Unexpected token '<'" and disappearing UI.
- Ensures identical behavior across environments.
- Aligns with Tailwind best practice (CDN is not for production).

**Next steps now:**
1) `npm install`
2) `npm run build:css`
3) Replace CDN lines in each HTML with `<link rel="stylesheet" href="/css/tailwind.css">`
4) Reload the app; the editor should render consistently without external dependencies.