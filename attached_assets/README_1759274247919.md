# Module 2+3 Fix Patch — Node 20 + Static Path (v3)

This patch fixes the Module 02/03 selftest failures by:
1) **Node 20**: selftests start the compiled server via `node dist/index.js` (no `tsx --loader`).
2) **Static path**: serve static files from `../dist/public` (see `DIFFS.md`).
3) **Port conflicts**: selftests **force `PORT=5050`** for consistency.
4) **Client build**: build from the **root** (`npm run build`), not `--prefix client`.
5) **Custom Module 03 log**: text log is `logs/mod-03b.log` (JSON remains `logs/selftest.mod-03.json`).

## Files
- `scripts.selftest.js` → drop-in replacement for `/scripts/selftest.js`
- `DIFFS.md` → copy/paste diffs for `/server/vite.ts` and `/server/index.ts`

## Apply
1. Replace `/scripts/selftest.js` with this version.
2. Apply diffs in `DIFFS.md` to point static files to `../dist/public`.
3. Run:
   ```bash
   npm run build
   MODULE_NUM=02 npm test
   MODULE_NUM=03 npm test   # writes logs/mod-03b.log
   ```

## Expected outcome
- Selftests avoid `tsx --loader` errors on Node 20+.
- Server finds static assets under `../dist/public`.
- No more port 5000 conflicts; tests bind to 5050.
- Module 03 text log → `logs/mod-03b.log`; JSON → `logs/selftest.mod-03.json`.
