import express from 'express'; import { load, save, paginate } from './data/fsStore';
export const router = express.Router();
router.post('/profiles', express.json(), async (req,res)=>{ const {name,email,headline}=req.body||{}; if(!name||!email) return res.status(400).json({error:'name and email are required'}); const items=await load('profiles.json',[]); if(items.some(p=>String(p.email).toLowerCase()===String(email).toLowerCase())) return res.status(409).json({error:'email exists'}); const profile={ id: crypto.randomUUID(), name, email, headline, createdAt: new Date().toISOString() }; items.push(profile); await save('profiles.json', items); return res.status(201).json({ profile }); });
router.get('/profiles', async (req,res)=>{ const q=String(req.query.q||'').toLowerCase(); const limit=Number(req.query.limit||20); const cursor=(req.query.cursor?String(req.query.cursor):undefined); const items=await load('profiles.json',[]); let filtered=items; if(q){ filtered=items.filter(p=>(p.name||'').toLowerCase().includes(q)||(p.email||'').toLowerCase().includes(q)||(p.headline||'').toLowerCase().includes(q)); } filtered.sort((a,b)=> b.createdAt.localeCompare(a.createdAt) || a.id.localeCompare(b.id)); const page=paginate(filtered, limit, cursor); return res.json(page); });
