import express from 'express'; import { load, save, paginate } from './data/fsStore';
export const router = express.Router();
router.post('/interviews', express.json(), async (req,res)=>{ const {profileId,title,scheduledAt,status}=req.body||{}; if(!profileId||!title) return res.status(400).json({error:'profileId and title are required'}); const profiles=await load('profiles.json',[]); if(!profiles.some(p=>p.id===profileId)) return res.status(404).json({error:'profile not found'}); const items=await load('interviews.json',[]); const interview={ id: crypto.randomUUID(), profileId, title, scheduledAt, status, createdAt: new Date().toISOString() }; items.push(interview); await save('interviews.json', items); return res.status(201).json({ interview }); });
router.get('/interviews', async (req,res)=>{ const profileId=String(req.query.profileId||''); const q=String(req.query.q||'').toLowerCase(); const limit=Number(req.query.limit||20); const cursor=(req.query.cursor?String(req.query.cursor):undefined); const items=await load('interviews.json',[]); let filtered=items; if(profileId) filtered=filtered.filter(i=>i.profileId===profileId); if(q) filtered=filtered.filter(i=>(i.title||'').toLowerCase().includes(q)); filtered.sort((a,b)=> b.createdAt.localeCompare(a.createdAt) || a.id.localeCompare(b.id)); const page=paginate(filtered, limit, cursor); return res.json(page); });
