# UI Unify + Home Attachments + Editable Avatar Patch

This patch delivers your 4 requests without breaking guardrails:

1. **Home > Attachments**: Adds an Attachments section (beneath "My Resumes") and hydrates it with non-resume uploads via existing APIs.
2. **Editable avatar on page**: The main-page avatar becomes hover-editable; click opens the native file picker and uploads to your avatar endpoint.
3. **Unified top menu** across user pages to match `profiles.html` menu items.
4. **Removes "New Profile" button** from the top bar across pages.

## Files
- `public/js/menu.unify.bind.js` — normalizes the header nav on user pages and removes the New Profile button.
- `public/js/home.attachments.bind.js` — inserts and hydrates the Attachments table on `/home.html`.
- `public/js/avatar_edit.bind.js` — makes the main avatar editable (not the header avatar).
- `scripts/apply_ui_unify_home_attachments_avatar.mjs` — injects these binders into routes in `index.js`.
- `scripts/selftest_ui_unify_home_attachments_avatar.mjs` — verifies script injection on all targeted routes.

## Endpoints (progressive fallbacks)
- **List attachments**: `/api/uploads?type=attachment` → fallback `/api/uploads?exclude=resumes=1` → fallback `/api/files?kind=attachment`
- **Delete attachment**: `DELETE /api/uploads/:id` → fallback `DELETE /api/files/:id`
- **Upload avatar** (multipart form-data, field `avatar`):
  - `POST /api/profile/avatar` → fallback `POST /api/users/me/avatar` → fallback `POST /api/me/avatar`

If your API differs, adjust only the URLs in the binder scripts.

## Apply on Replit
```bash
unzip ui_unify_home_attachments_avatar_patch.zip -d /tmp/oi && cp -R /tmp/oi/* .
node scripts/apply_ui_unify_home_attachments_avatar.mjs
# restart your server (e.g., npm run dev)
npm i supertest cheerio
node scripts/selftest_ui_unify_home_attachments_avatar.mjs
```

## Notes
- **No base HTML bytes changed**: behavior is injected so existing checksums/guardrails stay intact.
- The avatar preview updates immediately after upload, using the API-returned URL (or a local object URL as fallback).
- The menu’s active item is highlighted by pathname match.
