<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Password</title>
  <meta name="robots" content="noindex,nofollow">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'">
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <main>
    <h1>Reset your password</h1>
    <form id="password-form" method="post" action="/api/password/reset">
      <input type="hidden" name="csrf_token" value="__CSRF__">
      <label for="email">Email</label>
      <input id="email" type="email" name="email" autocomplete="email" required aria-required="true">
      <label for="token">Reset Token</label>
      <input id="token" type="text" name="token" required aria-required="true" inputmode="numeric">
      <label for="new_password">New Password</label>
      <input id="new_password" type="password" name="new_password" minlength="8" required aria-required="true" aria-describedby="pw_rules pw_strength">
      <button id="toggle_pw" type="button" aria-controls="new_password" aria-pressed="false">Show</button>
      <label for="confirm_password">Confirm Password</label>
      <input id="confirm_password" type="password" name="confirm_password" minlength="8" required aria-required="true">
      <div id="pw_strength" role="status" aria-live="polite">Strength: -</div>
      <p id="pw_rules">Use 8+ chars, upper/lowercase, number, symbol.</p>
      <div id="errors" role="alert" aria-live="assertive"></div>
      <button id="submit_btn" type="submit" disabled>Set new password</button>
      <a id="back_to_login" href="/login.html">Back to login</a>
    </form>
  </main>
  <script>
    (function(){
      const pw = document.getElementById('new_password');
      const conf = document.getElementById('confirm_password');
      const btn = document.getElementById('submit_btn');
      const toggle = document.getElementById('toggle_pw');
      function validate(){
        btn.disabled = !(pw.value.length >= 8 && pw.value === conf.value);
      }
      pw.addEventListener('input', validate);
      conf.addEventListener('input', validate);
      toggle.addEventListener('click', function(){
        const t = pw.type === 'password' ? 'text' : 'password';
        pw.type = t; conf.type = t;
        const pressed = this.getAttribute('aria-pressed') === 'true';
        this.setAttribute('aria-pressed', (!pressed).toString());
      });
    })();
  </script>
</body>
</html>
